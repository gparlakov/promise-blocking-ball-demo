<html>
<head>
    <style>
        ball {
            z-index:2;
            display: block;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: fixed;
            left:calc(50vw - 25px);
            border:1px solid rgba(0,0,0,0.3);
            box-shadow: inset 0 -15px 15px -5px rgba(0,0,0,0.2);
            background-color: 'deepskyblue';
        }
    </style>
</head>
<body><input id="promise-count"/>
<button id="run">Starts</button>
<!-- <button id="stop-ball">stop ball</button> -->
<button id="toggle">Toggle recursive/immediate</button>
<ball></ball>

<script>
// promises

// loop parameters
let maxTries = 10;
let counter = 0;
let recursive = true;


function promiseLoop() {
  if (counter < maxTries) {
    console.log(counter);
    counter += 1;
    // schedule a new promise immediately after previous resolves
    Promise.resolve().then(() => {
      promiseLoop();
    });
  }
}

function promiseQueue() {
  while (counter < maxTries) {
    counter += 1;
    // schedule a new promise immediately after previous resolves
    Promise.resolve().then(() => console.log(counter));
  }
}

// control the loop
const inputCount = document.getElementById('promise-count');
inputCount.focus();
function runPromiseLoop() {
  counter = 0;
  const val = parseInt(inputCount.value);
  maxTries = isNaN(val) ? maxTries : val;
  if(recursive) {
    promiseLoop();
  } else {
    promiseQueue();
  }
}

const button = document.getElementById('run');
button.onclick = runPromiseLoop;

inputCount.onkeyup = function(key) {
    if(key.key == "Enter") {
        runPromiseLoop();
    }
}


</script>
<script>

// ball js animation
const ball = document.getElementsByTagName('ball')[0];

function bounce() {
  let out = ball.getBoundingClientRect().top >= window.innerHeight;
  ball.style.top = (out ? 0 : ball.getBoundingClientRect().top + 1.5) + "px";
}




// LOOP with REQUEST ANIMATION FRAME
function ballLoop() {
  requestAnimationFrame(() => {
    bounce();
    ballLoop();
  })
  // requestAnimationFrame(() => {
  //   bounce();
  // })
}
ballLoop();




// LOOP with SET INTERVAL
// const intervalId = setInterval(() => {
//   // console.log('animation',ball.getBoundingClientRect().top, ball.style.top);
//   bounce();
// }, 16);

// if stop ball button rendered
const stopBallButton = document.getElementById('stop-ball')
stopBallButton && (stopBallButton.onclick = function() {
  clearInterval(intervalId);
});
</script>
</body>
</html>
